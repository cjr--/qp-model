define(module,function(e,t){var n=t("qp-utility");n.make(e,{ns:"qp-model/model",create:function(e,t){e.create(t,{instance:this})},refresh:function(){},set_user:function(e){n.is(e,"array")&&(e=n.find(e,{id:this.user_id})),n.is(e,"user")&&(this.user=e,this.user_id=e.id)}})}),define(module,function(e,t){var n=t("qp-utility");function i(){return""}function a(){return 0}function u(){return!1}function r(){return new Date}function l(){return(new Date).setUTCHours(12,0,0,0)}n.module(e,{ns:"qp-model/schema",build:function(e,t){t.create=this.create.bind(this,t.columns),t.schema_name=t.schema||!1,t.set_schema=this.set_schema.bind(this,t);var i=t.schema_name?t.schema_name+".":"";t.table={name:t.table,fullname:i+t.table,id_sequence_name:i+t.table+"_id_seq"},t.fields={managed:[],all:[]},n.each_own(t.columns,function(e,n){e.name=n,e.managed?t.fields.managed.push(n):t.fields.all.push(n)}),e(t)},set_schema:function(e,t){!1===e.schema_name&&(e.schema_name=t),e.table.fullname=(e.schema_name?e.schema_name+".":"")+e.table.name,e.table.id_sequence_name=e.table.fullname+"_id_seq"},create:function(e,t,i){return i=n.options(i,{internal:!1}),n.is(t,"array")?n.map(t,function(t){return this.create_item(e,t,{},i)}.bind(this)):n.is(t,"object","undefined")?this.create_item(e,t||{},i.instance||{},i):null},create_item:function(e,t,i,a){return n.is(t,"object")&&n.each_own(e,function(e,n){!a.internal&&e.internal||(i[n]=t[n]||e.default())}),i||{}},field:function(e,t,s,d){var f;return n.is(t,"object","undefined")?(d=t,t=s=0):n.is(s,"object","undefined")&&(d=s,s=0),d=d||{},f="text"===e&&0===t?{type:"varchar",size:t,default:d.default||i}:"text"===e?{type:"text",default:d.default||i}:"smallint"===e||"int2"===e?{type:"smallint",size:2,default:d.default||a}:"int"===e||"int4"===e||"integer"===e?{type:"integer",size:4,default:d.default||a}:"bigint"===e||"int8"===e?{type:"bigint",size:8,default:d.default||a}:"numeric"===e||"decimal"===e||"number"===e?{type:"numeric",size:t,scale:s,default:d.default||a}:"currency"===e?{type:"numeric",size:12,scale:4,default:d.default||a}:"bool"===e||"boolean"===e?{type:"boolean",default:d.default||u}:"datetime"===e?{type:"timestamp with time zone",default:d.default||r}:"date"===e?{type:"timestamp with time zone",default:d.default||l}:"smallserial"===e?{type:"smallserial",default:n.noop}:"serial"===e?{type:"serial",default:n.noop}:"bigserial"===e?{type:"bigserial",default:n.noop}:{type:"",default:n.noop},n.options(f,d)},primary:function(){return this.field("integer",{primary:!0,managed:!0})},primary_key:function(){return this.field("integer",{primary_key:!0,sequence:!0,managed:!1})},foreign:function(e){return this.field("integer",{foreign:!0,table:e})},foreign_ids:function(e){return this.field("integer",{foreign:!0,table:e,array:!0})},unique:function(){return this.field("integer",{unique:!0,managed:!1})},created:function(){return this.field("datetime",{managed:!0})},modified:function(){return this.field("datetime",{managed:!0})}})});