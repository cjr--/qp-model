define(module,function(e,t){var n=t("qp-utility");n.make(e,{ns:"qp-model/model",create:function(e,t){e.create(t,{instance:this})},refresh:function(){},set_user:function(e){n.is(e,"array")&&(e=n.find(e,{id:this.user_id})),n.is(e,"user")&&(this.user=e,this.user_id=e.id)}})}),define(module,function(e,t){var n=t("qp-utility");function i(){return""}function a(){return 0}function u(){return!1}function l(){return new Date}function s(){return(new Date).setUTCHours(12,0,0,0)}function d(){return""}n.module(e,{ns:"qp-model/schema",extend:function(e,i){var a=t(i.extend);n.each_own(i.indexes,function(e,t){e.name=t,a.indexes[t]=e}),n.each_own(i.columns,function(e,t){e.name=t,a.columns[t]=e,e.managed?a.fields.managed.push(t):a.fields.all.push(t)}),n.each(i.meta.columns,function(e,t){var n=a.columns[e.name];n.index=t,0!==e.width?n.width=e.width:n.boolean?n.width=6:n.array?n.width=30:n.primary||n.primary_key||n.foreign?n.width=6:n.datetime?n.width=24:n.int?n.width={2:6,4:11,8:20}[n.size]:n.numeric?n.width=n.size+n.scale+1:n.text?n.width=n.size||30:n.data&&(n.width=30),n.width=Math.max(n.name.length,n.width)}),e(a)},build:function(e,t){t.create=this.create.bind(this,t.columns),t.schema_name=t.schema||!1,t.set_schema=this.set_schema.bind(this,t);var i=t.schema_name?t.schema_name+".":"";t.table={name:t.table,fullname:i+t.table,id_sequence_name:i+t.table+"_id_seq"},t.fields={managed:[],all:[]},t.columns=t.columns||{},n.each_own(t.columns,function(e,n){e.name=n,e.managed?t.fields.managed.push(n):t.fields.all.push(n)}),t.indexes=t.indexes||{},n.each_own(t.indexes,function(e,t){e.name=t}),e(t)},set_schema:function(e,t){!1===e.schema_name&&(e.schema_name=t);var i=e.schema_name?e.schema_name+".":"";e.table.fullname=i+e.table.name,e.table.id_sequence_name=e.table.fullname+"_id_seq",n.each_own(e.columns,function(e,t){e.table&&(e.table_fullname=i+e.table),e.fullname=i+t})},create:function(e,t,i){return i=n.options(i,{internal:!1}),n.is(t,"array")?n.map(t,function(t){return this.create_item(e,t,{},i)}.bind(this)):n.is(t,"object","undefined")?this.create_item(e,t||{},i.instance||{},i):null},create_item:function(e,t,i,a){return n.is(t,"object")&&n.each_own(e,function(e,n){!a.internal&&e.internal||(i[n]=t[n]||e.default())}),i||{}},index:function(e,t){return n.is(e,"object")?t=e||{}:n.is(e,"string")&&((t=t||{}).column=e),n.options(t,{column:null,expression:null,method:"btree",unique:!1,asc:!0,desc:!1})},field:function(e,t,r,m){var c;return n.is(t,"object","undefined")?(m=t,t=r=0):n.is(r,"object","undefined")&&(m=r,r=0),m=m||{},c="text"===e&&0===t?{type:"text",text:!0,size:0,default:m.default||i}:"text"===e?{type:"varchar",text:!0,size:t,default:m.default||i}:"smallint"===e||"int2"===e?{type:"smallint",int:!0,size:2,default:m.default||a}:"int"===e||"int4"===e||"integer"===e?{type:"integer",int:!0,size:4,default:m.default||a}:"bigint"===e||"int8"===e?{type:"bigint",int:!0,size:8,default:m.default||a}:"numeric"===e||"decimal"===e||"number"===e?{type:"numeric",numeric:!0,size:t,scale:r,default:m.default||a}:"currency"===e?{type:"numeric",numeric:!0,size:12,scale:4,default:m.default||a}:"bool"===e||"boolean"===e?{type:"boolean",boolean:!0,default:m.default||u}:"dt"===e||"datetime"===e?{type:"timestamp with time zone",datetime:!0,default:m.default||l}:"date"===e?{type:"timestamp with time zone",date:!0,default:m.default||s}:"bytea"===e?{type:"bytea",data:!0,default:m.default||d}:"smallserial"===e?{type:"smallserial",int:!0,size:2,default:n.noop}:"serial"===e?{type:"serial",int:!0,size:4,default:n.noop}:"bigserial"===e?{type:"bigserial",int:!0,size:8,default:n.noop}:{type:"",default:n.noop},n.options(c,m)},primary:function(){return this.field("integer",{primary:!0,managed:!0})},primary_key:function(){return this.field("integer",{primary_key:!0,sequence:!0,managed:!1})},foreign:function(e){return this.field("integer",{foreign:!0,table:e})},foreign_ids:function(e){return this.field("integer",{foreign:!0,table:e,array:!0})},unique:function(){return this.field("integer",{unique:!0,managed:!1})},created:function(){return this.field("datetime",{managed:!0})},modified:function(){return this.field("datetime",{managed:!0})}})});