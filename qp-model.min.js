define(module,function(e,n){var t=n("qp-utility");t.make(e,{ns:"qp-model/model",create:function(e,n){e.create(n,{instance:this})},refresh:function(){},set_user:function(e){t.is(e,"array")&&(e=t.find(e,{id:this.user_id})),t.is(e,"user")&&(this.user=e,this.user_id=e.id)}})}),define(module,function(e,n){var t=n("qp-utility");function i(){return""}function a(){return 0}function u(){return!1}function l(){return new Date}function s(){return(new Date).setUTCHours(12,0,0,0)}function r(){return""}t.module(e,{ns:"qp-model/schema",extend:function(e,i){var a=n(i.extend);t.each_own(i.indexes,function(e,n){e.name=n,a.indexes[n]=e}),t.each_own(i.columns,function(e,n){e.name=n,a.columns[n]=e,e.managed?a.fields.managed.push(n):a.fields.all.push(n)}),e(a)},build:function(e,n){n.create=this.create.bind(this,n.columns),n.schema_name=n.schema||!1,n.set_schema=this.set_schema.bind(this,n);var i=n.schema_name?n.schema_name+".":"";n.table={name:n.table,fullname:i+n.table,id_sequence_name:i+n.table+"_id_seq"},n.fields={managed:[],all:[]},n.columns=n.columns||{},t.each_own(n.columns,function(e,t){e.name=t,e.managed?n.fields.managed.push(t):n.fields.all.push(t)}),n.indexes=n.indexes||{},t.each_own(n.indexes,function(e,n){e.name=n}),e(n)},set_schema:function(e,n){!1===e.schema_name&&(e.schema_name=n);var i=e.schema_name?e.schema_name+".":"";e.table.fullname=i+e.table.name,e.table.id_sequence_name=e.table.fullname+"_id_seq",t.each_own(e.columns,function(e,n){e.table&&(e.table_fullname=i+e.table),e.fullname=i+n})},create:function(e,n,i){return i=t.options(i,{internal:!1}),t.is(n,"array")?t.map(n,function(n){return this.create_item(e,n,{},i)}.bind(this)):t.is(n,"object","undefined")?this.create_item(e,n||{},i.instance||{},i):null},create_item:function(e,n,i,a){return t.is(n,"object")&&t.each_own(e,function(e,t){!a.internal&&e.internal||(i[t]=n[t]||e.default())}),i||{}},index:function(e,n){return t.is(e,"object")?n=e||{}:t.is(e,"string")&&((n=n||{}).column=e),t.options(n,{column:null,expression:null,method:"btree",unique:!1,asc:!0,desc:!1})},field:function(e,n,d,c){var f;return t.is(n,"object","undefined")?(c=n,n=d=0):t.is(d,"object","undefined")&&(c=d,d=0),c=c||{},f="text"===e&&0===n?{type:"varchar",size:n,default:c.default||i}:"text"===e?{type:"text",default:c.default||i}:"smallint"===e||"int2"===e?{type:"smallint",size:2,default:c.default||a}:"int"===e||"int4"===e||"integer"===e?{type:"integer",size:4,default:c.default||a}:"bigint"===e||"int8"===e?{type:"bigint",size:8,default:c.default||a}:"numeric"===e||"decimal"===e||"number"===e?{type:"numeric",size:n,scale:d,default:c.default||a}:"currency"===e?{type:"numeric",size:12,scale:4,default:c.default||a}:"bool"===e||"boolean"===e?{type:"boolean",default:c.default||u}:"dt"===e||"datetime"===e?{type:"timestamp with time zone",default:c.default||l}:"date"===e?{type:"timestamp with time zone",default:c.default||s}:"bytea"===e?{type:"bytea",default:c.default||r}:"smallserial"===e?{type:"smallserial",default:t.noop}:"serial"===e?{type:"serial",default:t.noop}:"bigserial"===e?{type:"bigserial",default:t.noop}:{type:"",default:t.noop},t.options(f,c)},primary:function(){return this.field("integer",{primary:!0,managed:!0})},primary_key:function(){return this.field("integer",{primary_key:!0,sequence:!0,managed:!1})},foreign:function(e){return this.field("integer",{foreign:!0,table:e})},foreign_ids:function(e){return this.field("integer",{foreign:!0,table:e,array:!0})},unique:function(){return this.field("integer",{unique:!0,managed:!1})},created:function(){return this.field("datetime",{managed:!0})},modified:function(){return this.field("datetime",{managed:!0})}})});