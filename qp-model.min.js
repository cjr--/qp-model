define(module,function(e,t){var n=t("qp-utility");n.make(e,{ns:"qp-model/model",create:function(e,t){e.create(t,{instance:this})},refresh:function(){},set_user:function(e){n.is(e,"array")&&(e=n.find(e,{id:this.user_id})),n.is(e,"user")&&(this.user=e,this.user_id=e.id)}})}),define(module,function(e,t){function n(){return""}function i(){return 0}function a(){return!1}function r(){return new Date}function u(){return(new Date).setUTCHours(12,0,0,0)}var o=t("qp-utility");o.module(e,{ns:"qp-model/schema",build:function(e,t){t.create=this.create.bind(this,t.columns),t.table={name:t.table},t.fields={managed:[],all:[]},o.each_own(t.columns,function(e,n){e.name=n,e.managed?t.fields.managed.push(n):t.fields.all.push(n)}),e(t)},create:function(e,t,n){return n=o.options(n,{internal:!1}),o.is(t,"array")?o.map(t,function(t){return this.create_item(e,t,{},n)}.bind(this)):o.is(t,"object")?this.create_item(e,t,n.instance||{},n):null},create_item:function(e,t,n,i){return o.is(t,"object")&&o.each_own(e,function(e,a){!i.internal&&e.internal||(n[a]=t[a]||e.default())}),n||{}},field:function(e,t,f){o.is(t,"object")&&(f=t),t=0;var d;return d="text"===e?t?{type:"varchar",size:t,default:n}:{type:"text",default:n}:"int"===e||"integer"===e?2===t?{type:"smallint",default:i}:8===t?{type:"bigint",default:i}:{type:"integer",default:i}:"bool"===e||"boolean"===e?{type:"boolean",default:a}:"datetime"===e?{type:"timestamp with time zone",default:r}:"date"===e?{type:"timestamp with time zone",default:u}:{type:"",default:o.noop},o.options(d,f)},primary:function(){return this.field("int",64,{primary:!0,managed:!0})},foreign:function(e){return this.field("int",64,{foreign:!0,table:e})},foreign_ids:function(e){return this.field("int",64,{foreign:!0,table:e,array:!0})},created:function(){return this.field("datetime",{managed:!0})},modified:function(){return this.field("datetime",{managed:!0})}})});